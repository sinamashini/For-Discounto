FROM node:16

ARG DATABASE_URL=postgresql://postgres:postgres@localhost:5432/zhava
ARG SESSION_SECRET_KEY=285d58936075ea6f0b447c2268caf514
ARG SMS_PROVIDER_APIKEY=4B54533437584B55423831754F375834676E666F51624C44775151444F524A335742466E637679375074493D
ARG PORT=3000
ARG MASTER_PASS=a00002163188a19ae85a61165bfc9d55!@
ENV DATABASE_URL ${DATABASE_URL}
ENV SESSION_SECRET_KEY ${SESSION_SECRET_KEY}
ENV SMS_PROVIDER_APIKEY ${SMS_PROVIDER_APIKEY}
ENV MASTER_PASS ${MASTER_PASS}

WORKDIR /usr/src/app

COPY package.json yarn.lock ./
COPY db/ ./db/
RUN yarn install --frozen-lockfile
RUN yarn blitz prisma migrate

COPY . .
RUN yarn build

EXPOSE ${PORT}

CMD yarn start -p ${PORT}
